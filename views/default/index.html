{{extend 'layout.html'}}

{{block head}}
{{end}}

<div class="main_content">

  <!DOCTYPE html>
  <html>

  <script type="text/javascript" src="static/js/read-csv.js"></script>
    <input type="file" id="csvFileInput" onchange="handleFiles(this.files)"
            accept=".csv">



  <p><strong>Tip:</strong> Use the Control or the Shift key to select multiple files.</p>

  </body>
  </html>

  <script>

  function handleFiles(files) {
     // Check for the various File API support.
     if (window.FileReader) {
         // FileReader are supported.
     } else {
         alert('FileReader are not supported in this browser.');
     }
   }

   function handleFiles(files) {
         // Check for the various File API support.
         if (window.FileReader) {
             // FileReader are supported.
             getAsText(files[0]);
         } else {
             alert('FileReader are not supported in this browser.');
         }
       }

       function getAsText(fileToRead) {
         var reader = new FileReader();
         // Read file into memory as UTF-8
         reader.readAsText(fileToRead);
         // Handle errors load
         reader.onload = loadHandler;
         reader.onerror = errorHandler;
       }

       function loadHandler(event) {
         var csv = event.target.result;
         processData(csv);
       }

       function processData(csv) {
           var allTextLines = csv.split(/\r\n|\n/);
           var lines = [];
           for (var i=0; i<allTextLines.length; i++) {
               var data = allTextLines[i].split(';');
                   var tarr = [];
                   for (var j=0; j<data.length; j++) {
                       tarr.push(data[j]);
                   }
                   lines.push(tarr);
           }
           parseLines(allTextLines);
         //console.log(lines);
       }

       function parseLines(lines) {
         for(var i=0; i<lines.length; i++) {
           var cell = lines[i].split(',');
           //console.log(cell);
           for(var j=0; j<cell.length; j++){
             var value = cell[j].substring(1, cell[j].length-1)
            //console.log(cell[j]);
          }
         }
         //below is test (working only with line 0)
         console.log(lines[0]);
         var cell1=lines[0].split(',');
         for(var j=0; j<cell1.length; j++){
           var value = cell1[j].substring(1, cell1[j].length-1)
           if(j=0) //date
            var date = value;
           else if(j=1) //price
            var price = value;
           else if(j=4) //description
            var description = value;
           console.log(value);
        }
       }

       function errorHandler(evt) {
         if(evt.target.error.name == "NotReadableError") {
             alert("Canno't read file !");
         }
       }

  </script>
</div>
