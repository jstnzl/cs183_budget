{{extend 'layout.html'}}

{{block head}}
{{end}}

<div class="main_content">

  <!DOCTYPE html>
  <html>

  <script type="text/javascript" src="static/js/read-csv.js"></script>
    <input type="file" id="csvFileInput" onchange="handleFiles(this.files)"
            accept=".csv">



  <p><strong>Tip:</strong> Use the Control or the Shift key to select multiple files.</p>

  </body>
  </html>

  <script>

   function handleFiles(files) {
         // Check for the various File API support.
         if (window.FileReader) {
             // FileReader are supported.
             getAsText(files[0]);
         } else {
             alert('FileReader are not supported in this browser.');
         }
       }

       function getAsText(fileToRead) {
         var reader = new FileReader();
         // Read file into memory as UTF-8
         reader.readAsText(fileToRead);
         // Handle errors load
         reader.onload = loadHandler;
         reader.onerror = errorHandler;
       }

       function loadHandler(event) {
         var csv = event.target.result;
         processData(csv);
       }

       function processData(csv) {
           var allTextLines = csv.split(/\r\n|\n/);
           var lines = [];
           for (var i=0; i<allTextLines.length; i++) {
               var data = allTextLines[i].split(';');
                   var tarr = [];
                   for (var j=0; j<data.length; j++) {
                       tarr.push(data[j]);
                   }
                   lines.push(tarr);
           }
           parseLines(allTextLines);
         //console.log(lines);
       }

       function parseLines(lines) {
         var date, price, description;
         for(var i=0; i<lines.length; i++) {
           var cell = lines[i].split(',');
           console.log(cell);
           for(var j=0; j<cell.length; j++){
             var value = cell[j].substring(1, cell[j].length-1)
             if(j==0){ //date
              var temp = value.split('/');
              date = new Date(temp[2],temp[0]-1,temp[1]);
              //console.log(date);
            }
             else if(j==1) //price
              price = parseFloat(value);
             else if(j==4) //description
              description = value;
            //console.log(cell[j]);
          }
         }
       }

       function errorHandler(evt) {
         if(evt.target.error.name == "NotReadableError") {
             alert("Cannot read file !");
         }
       }

  </script>
</div>
